<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>haosong/notes.git</title>
  
  <subtitle>repository of my random notes</subtitle>
  <link href="https://haosong.name/atom.xml" rel="self"/>
  
  <link href="https://haosong.name/"/>
  <updated>2021-05-30T16:38:56.784Z</updated>
  <id>https://haosong.name/</id>
  
  <author>
    <name>Hao Song</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Viewing debug level logs from iOS simulator</title>
    <link href="https://haosong.name/2021/05/30/viewing-debug-level-logs-from-ios-simulator/"/>
    <id>https://haosong.name/2021/05/30/viewing-debug-level-logs-from-ios-simulator/</id>
    <published>2021-05-30T16:38:09.000Z</published>
    <updated>2021-05-30T16:38:56.784Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Unified-logging-system-aka-os-log"><a href="#Unified-logging-system-aka-os-log" class="headerlink" title="Unified logging system (aka os_log)"></a>Unified logging system (aka <code>os_log</code>)</h2><p>The <a href="https://developer.apple.com/documentation/os/logging">unified logging system</a> (aka <code>os_log</code>) is the recommended way of logging by Apple. It’s pretty easy to create a logger and log messages at different levels:</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"><span class="keyword">import</span> os.log</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Logger</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> button <span class="operator">=</span> <span class="type">Logger</span>(subsystem: <span class="string">&quot;name.haosong.OSLogDemo&quot;</span>, category: <span class="string">&quot;Button&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ContentView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">Button</span>(<span class="string">&quot;Debug&quot;</span>, action: &#123;</span><br><span class="line">                <span class="type">Logger</span>.button.log(level: .debug, <span class="string">&quot;debug log&quot;</span>)</span><br><span class="line">            &#125;).padding()</span><br><span class="line">            </span><br><span class="line">            <span class="type">Button</span>(<span class="string">&quot;Info&quot;</span>, action: &#123;</span><br><span class="line">                <span class="type">Logger</span>.button.log(level: .info, <span class="string">&quot;info log&quot;</span>)</span><br><span class="line">            &#125;).padding()</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><span id="more"></span><p>On macOS, we can view the log messages using the Console app. But the <code>debug</code> level messages from iOS simulators are not visible even after turning on the <code>Include Info Messages</code> and <code>Include Debug Messages</code> in <code>Action</code> menu of the Console app. </p><p>This could be <a href="https://developer.apple.com/forums/thread/82736?answerId=347949022#347949022">a bug of the simulator</a>, because <code>debug</code> level messages from iOS devices are not affected in the Console app. </p><h2 id="Streaming-debug-logs-from-the-simulator-to-Terminal"><a href="#Streaming-debug-logs-from-the-simulator-to-Terminal" class="headerlink" title="Streaming debug logs from the simulator to Terminal"></a>Streaming debug logs from the simulator to Terminal</h2><p>The workaround is to stream the log from the simulator to Terminal:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># if the simulator is already booted</span></span><br><span class="line">$ xcrun simctl spawn booted <span class="built_in">log</span> stream --level debug --predicate <span class="string">&#x27;subsystem == &quot;name.haosong.OSLogDemo&quot;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># or you can use the device UUID</span></span><br><span class="line">$ xcrun simctl spawn &lt;DEVICE-UUID&gt; <span class="built_in">log</span> stream --level debug --predicate <span class="string">&#x27;subsystem == &quot;name.haosong.OSLogDemo&quot;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul><li><a href="https://developer.apple.com/forums/thread/82736?answerId=347949022#347949022">Console app not showing info and debug logs | Apple Developer Forums</a></li><li><a href="https://www.iosdev.recipes/simulator/os_log/">Using os_log and log streaming on iOS</a></li><li><a href="https://www.avanderlee.com/workflow/oslog-unified-logging/">OSLog and Unified logging as recommended by Apple - SwiftLee</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;Unified-logging-system-aka-os-log&quot;&gt;&lt;a href=&quot;#Unified-logging-system-aka-os-log&quot; class=&quot;headerlink&quot; title=&quot;Unified logging system (aka os_log)&quot;&gt;&lt;/a&gt;Unified logging system (aka &lt;code&gt;os_log&lt;/code&gt;)&lt;/h2&gt;&lt;p&gt;The &lt;a href=&quot;https://developer.apple.com/documentation/os/logging&quot;&gt;unified logging system&lt;/a&gt; (aka &lt;code&gt;os_log&lt;/code&gt;) is the recommended way of logging by Apple. It’s pretty easy to create a logger and log messages at different levels:&lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; SwiftUI&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; os.log&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;extension&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Logger&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; button &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;Logger&lt;/span&gt;(subsystem: &lt;span class=&quot;string&quot;&gt;&amp;quot;name.haosong.OSLogDemo&amp;quot;&lt;/span&gt;, category: &lt;span class=&quot;string&quot;&gt;&amp;quot;Button&amp;quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ContentView&lt;/span&gt;: &lt;span class=&quot;title&quot;&gt;View&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; body: &lt;span class=&quot;keyword&quot;&gt;some&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;View&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;VStack&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;type&quot;&gt;Button&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;Debug&amp;quot;&lt;/span&gt;, action: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;type&quot;&gt;Logger&lt;/span&gt;.button.log(level: .debug, &lt;span class=&quot;string&quot;&gt;&amp;quot;debug log&amp;quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;).padding()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;type&quot;&gt;Button&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;Info&amp;quot;&lt;/span&gt;, action: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;type&quot;&gt;Logger&lt;/span&gt;.button.log(level: .info, &lt;span class=&quot;string&quot;&gt;&amp;quot;info log&amp;quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;).padding()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// ...&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="develop" scheme="https://haosong.name/categories/develop/"/>
    
    
    <category term="ios" scheme="https://haosong.name/tags/ios/"/>
    
    <category term="debug" scheme="https://haosong.name/tags/debug/"/>
    
    <category term="os_log" scheme="https://haosong.name/tags/os-log/"/>
    
  </entry>
  
  <entry>
    <title>How to call C variadic functions from Swift?</title>
    <link href="https://haosong.name/2021/05/29/how-to-call-c-variadic-functions-from-swift/"/>
    <id>https://haosong.name/2021/05/29/how-to-call-c-variadic-functions-from-swift/</id>
    <published>2021-05-29T19:36:44.000Z</published>
    <updated>2021-05-29T22:02:28.289Z</updated>
    
    <content type="html"><![CDATA[<p>In this article we’re going to create a Swift wrapper function for a C function that use the <code>...</code> syntax for variadic arguments:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">my_sum</span><span class="params">(<span class="keyword">int</span> n, ...)</span></span>;</span><br></pre></td></tr></table></figure><p><code>...</code> variadic arguments syntax is not supported by default in Swift, you will get compiler errors like this:</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;my_sum&#x27;</span> <span class="keyword">is</span> unavailable: <span class="keyword">Variadic</span> <span class="keyword">function</span> <span class="keyword">is</span> unavailable</span><br></pre></td></tr></table></figure><p>There’s a way to workaround this limitation, if you can modify the C function to take <code>va_list</code> as parameter.</p><span id="more"></span><h2 id="Create-a-new-C-function-with-va-list"><a href="#Create-a-new-C-function-with-va-list" class="headerlink" title="Create a new C function with va_list"></a>Create a new C function with <code>va_list</code></h2><p>The original function looks like this:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">my_sum</span><span class="params">(<span class="keyword">int</span> n, ...)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> result = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    va_list args;</span><br><span class="line">    va_start(args, n);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        result += va_arg(args, <span class="keyword">int</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    va_end(args);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>To avoid duplicating the logic, we can create a new version take a <code>va_list</code> as parameter, and call the new version from the original function:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// New version </span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">my_vsum</span><span class="params">(<span class="keyword">int</span> n, va_list arguments)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> result = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        result += va_arg(arguments, <span class="keyword">int</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Original</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">my_sum</span><span class="params">(<span class="keyword">int</span> n, ...)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    va_list args;</span><br><span class="line">    va_start(args, n);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> result = my_vsum(n, args);</span><br><span class="line">    </span><br><span class="line">    va_end(args);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Create-a-Swift-wrapper-with-CVarArg"><a href="#Create-a-Swift-wrapper-with-CVarArg" class="headerlink" title="Create a Swift wrapper with CVarArg"></a>Create a Swift wrapper with <code>CVarArg</code></h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mySwiftSum</span>(<span class="keyword">_</span> <span class="params">n</span>: <span class="type">Int32</span>, <span class="keyword">_</span> <span class="params">arguments</span>: <span class="type">CVarArg</span>...)</span> -&gt; <span class="type">Int32</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">withVaList</span>(arguments) &#123; my_vsum(n, <span class="variable">$0</span>) &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Now we can use this function in Swift:</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> sum <span class="operator">=</span> mySwiftSum(<span class="number">5</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;sum = <span class="subst">\(sum)</span>&quot;</span>) </span><br><span class="line"><span class="comment">// Prints &quot;sum = 15&quot;</span></span><br></pre></td></tr></table></figure><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul><li><a href="https://developer.apple.com/documentation/swift/cvararg">CVarArg | Apple Developer Documentation</a></li><li><a href="https://stackoverflow.com/questions/24195796/how-do-you-call-an-objective-c-variadic-method-from-swift">How do you call an Objective-C variadic method from Swift?</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;In this article we’re going to create a Swift wrapper function for a C function that use the &lt;code&gt;...&lt;/code&gt; syntax for variadic arguments:&lt;/p&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;my_sum&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; n, ...)&lt;/span&gt;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;code&gt;...&lt;/code&gt; variadic arguments syntax is not supported by default in Swift, you will get compiler errors like this:&lt;/p&gt;
&lt;figure class=&quot;highlight pgsql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&amp;#x27;my_sum&amp;#x27;&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; unavailable: &lt;span class=&quot;keyword&quot;&gt;Variadic&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; unavailable&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;There’s a way to workaround this limitation, if you can modify the C function to take &lt;code&gt;va_list&lt;/code&gt; as parameter.&lt;/p&gt;</summary>
    
    
    
    <category term="develop" scheme="https://haosong.name/categories/develop/"/>
    
    
    <category term="swift" scheme="https://haosong.name/tags/swift/"/>
    
    <category term="c" scheme="https://haosong.name/tags/c/"/>
    
    <category term="variadic function" scheme="https://haosong.name/tags/variadic-function/"/>
    
    <category term="va_list" scheme="https://haosong.name/tags/va-list/"/>
    
  </entry>
  
  <entry>
    <title>Signing Git Commits Using GPG</title>
    <link href="https://haosong.name/2021/05/25/signing-git-commits-using-gpg/"/>
    <id>https://haosong.name/2021/05/25/signing-git-commits-using-gpg/</id>
    <published>2021-05-25T21:59:02.000Z</published>
    <updated>2021-05-27T00:26:24.330Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h2><p>To sign git commits on macOS, we need to install <code>gpg</code> and <code>pinentry-mac</code> (for storing passphrase in keychain).</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew install gpg pinentry-mac</span><br></pre></td></tr></table></figure><h2 id="Setup-GPG"><a href="#Setup-GPG" class="headerlink" title="Setup GPG"></a>Setup GPG</h2><p>Add the following line to <code>~/.gnupg/gpg-agent.conf</code>:</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pinentry-program <span class="regexp">/usr/</span>local<span class="regexp">/bin/</span>pinentry-mac</span><br></pre></td></tr></table></figure><p>Add the following lines to <code>~/.gnupg/gpg.conf</code>:</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">no</span>-tty</span><br><span class="line"><span class="keyword">use</span>-agent</span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="Generate-a-GPG-key"><a href="#Generate-a-GPG-key" class="headerlink" title="Generate a GPG key"></a>Generate a GPG key</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gpg --full-generate-key</span><br></pre></td></tr></table></figure><p>Follow the instruction here: <a href="https://docs.github.com/en/github/authenticating-to-github/managing-commit-signature-verification/generating-a-new-gpg-key">Generating a new GPG key</a></p><h2 id="Confirm-GPG-is-working"><a href="#Confirm-GPG-is-working" class="headerlink" title="Confirm GPG is working"></a>Confirm GPG is working</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;hello world&quot;</span> | gpg --clearsign</span><br></pre></td></tr></table></figure><p>We can restart gpg agent if needed:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ gpgconf --<span class="built_in">kill</span> gpg-agent</span><br><span class="line">$ gpgconf --launch gpg-agent</span><br></pre></td></tr></table></figure><h2 id="Set-GPG-signing-key-in-Git"><a href="#Set-GPG-signing-key-in-Git" class="headerlink" title="Set GPG signing key in Git"></a>Set GPG signing key in Git</h2><p>List all the keys:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gpg --list-secret-keys --keyid-format LONG</span><br></pre></td></tr></table></figure><p>In the output find out the Key ID with the following format (assuming we picked <code>RSA</code> and <code>4096</code> bits key size when generating GPG key): </p><figure class="highlight node-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">...</span></span><br><span class="line">sec   rsa4096/&#123;KEY-ID&#125; </span><br><span class="line"><span class="meta">...</span></span><br></pre></td></tr></table></figure><p>Tell git which key to use:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global user.signingkey &#123;KEY-ID&#125;</span><br></pre></td></tr></table></figure><p>To sign all commits automatically:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global commit.gpgsign <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>To sign all tags automatically:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global tag.forceSignAnnotated <span class="literal">true</span></span><br></pre></td></tr></table></figure><h2 id="Add-GPG-key-to-GitHub"><a href="#Add-GPG-key-to-GitHub" class="headerlink" title="Add GPG key to GitHub"></a>Add GPG key to GitHub</h2><p>Print the GPG key: </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gpg --armor --<span class="built_in">export</span> &#123;KEY-ID&#125;</span><br></pre></td></tr></table></figure><p>Copy the GPG key, beginning with <code>-----BEGIN PGP PUBLIC KEY BLOCK-----</code> and ending with <code>-----END PGP PUBLIC KEY BLOCK-----</code>, and <a href="https://docs.github.com/en/github/authenticating-to-github/managing-commit-signature-verification/adding-a-new-gpg-key-to-your-github-account">add it to GitHub SSH and GPG keys Settings</a>.</p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul><li><a href="https://merikan.com/2019/05/how-to-sign-git-commits/">How to Sign Git Commits</a></li><li><a href="https://withblue.ink/2020/05/17/how-and-why-to-sign-git-commits.html">How (and why) to sign Git commits</a></li><li><a href="https://docs.github.com/en/github/authenticating-to-github/managing-commit-signature-verification/telling-git-about-your-signing-key">Telling Git about your signing key</a></li><li><a href="https://docs.github.com/en/github/authenticating-to-github/managing-commit-signature-verification/generating-a-new-gpg-key">Generating a new GPG key</a></li><li><a href="https://docs.github.com/en/github/authenticating-to-github/managing-commit-signature-verification/adding-a-new-gpg-key-to-your-github-account">Adding a new GPG key to your GitHub account</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;Installation&quot;&gt;&lt;a href=&quot;#Installation&quot; class=&quot;headerlink&quot; title=&quot;Installation&quot;&gt;&lt;/a&gt;Installation&lt;/h2&gt;&lt;p&gt;To sign git commits on macOS, we need to install &lt;code&gt;gpg&lt;/code&gt; and &lt;code&gt;pinentry-mac&lt;/code&gt; (for storing passphrase in keychain).&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ brew install gpg pinentry-mac&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&quot;Setup-GPG&quot;&gt;&lt;a href=&quot;#Setup-GPG&quot; class=&quot;headerlink&quot; title=&quot;Setup GPG&quot;&gt;&lt;/a&gt;Setup GPG&lt;/h2&gt;&lt;p&gt;Add the following line to &lt;code&gt;~/.gnupg/gpg-agent.conf&lt;/code&gt;:&lt;/p&gt;
&lt;figure class=&quot;highlight awk&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;pinentry-program &lt;span class=&quot;regexp&quot;&gt;/usr/&lt;/span&gt;local&lt;span class=&quot;regexp&quot;&gt;/bin/&lt;/span&gt;pinentry-mac&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;Add the following lines to &lt;code&gt;~/.gnupg/gpg.conf&lt;/code&gt;:&lt;/p&gt;
&lt;figure class=&quot;highlight perl&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;no&lt;/span&gt;-tty&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;use&lt;/span&gt;-agent&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="develop" scheme="https://haosong.name/categories/develop/"/>
    
    
    <category term="git" scheme="https://haosong.name/tags/git/"/>
    
    <category term="gpg" scheme="https://haosong.name/tags/gpg/"/>
    
    <category term="mac" scheme="https://haosong.name/tags/mac/"/>
    
  </entry>
  
  <entry>
    <title>first commit</title>
    <link href="https://haosong.name/2016/02/16/first-commit/"/>
    <id>https://haosong.name/2016/02/16/first-commit/</id>
    <published>2016-02-17T07:03:09.000Z</published>
    <updated>2020-06-18T21:46:10.320Z</updated>
    
    <content type="html"><![CDATA[<p>Finally got my blog up with <a href="https://hexo.io/">Hexo</a> and <a href="https://pages.github.com/">GitHub pages</a>. :D </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Finally got my blog up with &lt;a href=&quot;https://hexo.io/&quot;&gt;Hexo&lt;/a&gt; and &lt;a href=&quot;https://pages.github.com/&quot;&gt;GitHub pages&lt;/a&gt;. :D &lt;/p&gt;
</summary>
      
    
    
    
    <category term="main" scheme="https://haosong.name/categories/main/"/>
    
    
    <category term="Hexo" scheme="https://haosong.name/tags/hexo/"/>
    
  </entry>
  
</feed>
